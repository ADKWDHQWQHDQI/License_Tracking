@model IEnumerable<License_Tracking.Models.Company>

@{
    ViewData["Title"] = "Companies - CBMS B2B2B CRM";
}

<div class="container-fluid">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="text-primary mb-1">
                        <i class="fas fa-building"></i> Companies
                    </h2>
                    <p class="text-muted mb-0">Manage your customers, prospects, and partners</p>
                </div>
                <div>
                    <button class="btn btn-outline-secondary me-2" onclick="toggleView()">
                        <i class="fas fa-table" id="viewToggleIcon"></i>
                        <span id="viewToggleText">Table View</span>
                    </button>
                    <a asp-action="Create" class="btn btn-primary">
                        <i class="fas fa-plus me-2"></i>Add Company
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="stats-card">
                <div class="stats-card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <p class="stats-card-title">Total Companies</p>
                            <h3 class="stats-card-value">@Model.Count()</h3>
                        </div>
                        <div class="stats-card-icon text-primary">
                            <i class="fas fa-building"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card">
                <div class="stats-card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <p class="stats-card-title">Customers</p>
                            <h3 class="stats-card-value text-success">@Model.Count(c => c.CompanyType == "Customer")
                            </h3>
                        </div>
                        <div class="stats-card-icon text-success">
                            <i class="fas fa-handshake"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card">
                <div class="stats-card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <p class="stats-card-title">Prospects</p>
                            <h3 class="stats-card-value text-warning">@Model.Count(c => c.CompanyType == "Prospect")
                            </h3>
                        </div>
                        <div class="stats-card-icon text-warning">
                            <i class="fas fa-eye"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card">
                <div class="stats-card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <p class="stats-card-title">Partners</p>
                            <h3 class="stats-card-value text-info">@Model.Count(c => c.CompanyType == "Partner")</h3>
                        </div>
                        <div class="stats-card-icon text-info">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Search and Filters -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
            <form asp-action="Index" method="get" class="row g-3">
                <div class="col-md-4">
                    <label class="form-label text-muted small">Search Companies</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light border-end-0">
                            <i class="fas fa-search text-muted"></i>
                        </span>
                        <input type="text" name="searchString" value="@ViewData["CurrentFilter"]"
                            class="form-control border-start-0" placeholder="Company name, industry..." />
                    </div>
                </div>
                <div class="col-md-3">
                    <label class="form-label text-muted small">Company Type</label>
                    <select name="companyType" class="form-select">
                        <option value="">All Types</option>
                        <option value="Customer" selected="@(ViewData["CompanyTypeFilter"]?.ToString() == "Customer")">
                            Customers</option>
                        <option value="Prospect" selected="@(ViewData["CompanyTypeFilter"]?.ToString() == "Prospect")">
                            Prospects</option>
                        <option value="Partner" selected="@(ViewData["CompanyTypeFilter"]?.ToString() == "Partner")">
                            Partners</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label text-muted small">Industry</label>
                    <select name="industry" class="form-select">
                        <option value="">All Industries</option>
                        <option value="Technology">Technology</option>
                        <option value="Manufacturing">Manufacturing</option>
                        <option value="Healthcare">Healthcare</option>
                        <option value="Finance">Finance</option>
                        <option value="Education">Education</option>
                        <option value="Retail">Retail</option>
                        <option value="Government">Government</option>
                    </select>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-filter me-1"></i>Filter
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Companies List -->
    <div id="cardView" class="row">
        @foreach (var item in Model)
        {
            <div class="col-md-6 col-lg-4 mb-3">
                <div class="card border-0 shadow-sm h-100 company-card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h5 class="card-title mb-1">@item.CompanyName</h5>
                            <span class="badge rounded-pill bg-@(item.CompanyType switch 
                                  {
                                      "Customer" => "success",
                                      "Prospect" => "warning", 
                                      "Partner" => "info",
                                      _ => "secondary"
                                  })">@item.CompanyType</span>
                        </div>

                        <div class="mb-3">
                            <small class="text-muted d-block">
                                <i class="fas fa-industry me-1"></i>@(item.Industry ?? "Not specified")
                            </small>
                            @if (!string.IsNullOrEmpty(item.CompanySize))
                            {
                                <small class="text-muted d-block">
                                    <i class="fas fa-users me-1"></i>@item.CompanySize employees
                                </small>
                            }
                            @if (!string.IsNullOrEmpty(item.Email))
                            {
                                <small class="text-muted d-block">
                                    <i class="fas fa-envelope me-1"></i>@item.Email
                                </small>
                            }
                        </div>

                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">
                                @if (item.CreatedDate != DateTime.MinValue)
                                {
                                    <span>Added @item.CreatedDate.ToString("MMM yyyy")</span>
                                }
                            </small>
                            <div class="btn-group" role="group">
                                <a asp-action="Details" asp-route-id="@item.CompanyId"
                                    class="btn btn-sm btn-outline-primary" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a asp-action="Edit" asp-route-id="@item.CompanyId" class="btn btn-sm btn-outline-secondary"
                                    title="Edit">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Table View (Hidden by default) -->
    <div id="tableView" class="d-none">
        <div class="card border-0 shadow-sm">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="border-0">Company</th>
                                <th class="border-0">Industry</th>
                                <th class="border-0">Type</th>
                                <th class="border-0">Contact</th>
                                <th class="border-0">Created</th>
                                <th class="border-0 text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td>
                                        <div>
                                            <strong>@item.CompanyName</strong>
                                            @if (!string.IsNullOrEmpty(item.CompanySize))
                                            {
                                                <br>
                                        
                                                <small class="text-muted">@item.CompanySize employees</small>
                                            }
                                        </div>
                                    </td>
                                    <td>@(item.Industry ?? "Not specified")</td>
                                    <td>
                                        <span class="badge rounded-pill bg-@(item.CompanyType switch 
                                              {
                                                  "Customer" => "success",
                                                  "Prospect" => "warning", 
                                                  "Partner" => "info",
                                                  _ => "secondary"
                                              })">@item.CompanyType</span>
                                    </td>
                                    <td>
                                        @if (!string.IsNullOrEmpty(item.Email))
                                        {
                                            <div>@item.Email</div>
                                        }
                                        @if (!string.IsNullOrEmpty(item.ContactNumber))
                                        {
                                            <small class="text-muted">@item.ContactNumber</small>
                                        }
                                    </td>
                                    <td>
                                        @if (item.CreatedDate != DateTime.MinValue)
                                        {
                                            <span>@item.CreatedDate.ToString("MMM dd, yyyy")</span>
                                        }
                                    </td>
                                    <td class="text-center">
                                        <div class="btn-group" role="group">
                                            <a asp-action="Details" asp-route-id="@item.CompanyId"
                                                class="btn btn-sm btn-outline-primary" title="View Details">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <a asp-action="Edit" asp-route-id="@item.CompanyId"
                                                class="btn btn-sm btn-outline-secondary" title="Edit">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <a asp-action="Delete" asp-route-id="@item.CompanyId"
                                                class="btn btn-sm btn-outline-danger" title="Delete"
                                                onclick="return confirm('Are you sure you want to delete this company?');">
                                                <i class="fas fa-trash"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    @if (!Model.Any())
    {
        <div class="text-center py-5">
            <i class="fas fa-building fa-3x text-muted mb-3"></i>
            <h4 class="text-muted">No Companies Found</h4>
            <p class="text-muted">Start by adding your first company to the system.</p>
            <a asp-action="Create" class="btn btn-primary">
                <i class="fas fa-plus me-2"></i>Add Your First Company
            </a>
        </div>
    }
</div>

@section Scripts {
    <script>
        let isCardView = true;

        function toggleView() {
            const cardView = document.getElementById('cardView');
            const tableView = document.getElementById('tableView');
            const toggleIcon = document.getElementById('viewToggleIcon');
            const toggleText = document.getElementById('viewToggleText');

            if (isCardView) {
                cardView.classList.add('d-none');
                tableView.classList.remove('d-none');
                toggleIcon.className = 'fas fa-th-large';
                toggleText.textContent = 'Card View';
                isCardView = false;
            } else {
                cardView.classList.remove('d-none');
                tableView.classList.add('d-none');
                toggleIcon.className = 'fas fa-table';
                toggleText.textContent = 'Table View';
                isCardView = true;
            }
        }

        // Auto-submit form on filter change
        document.querySelectorAll('select').forEach(select => {
            select.addEventListener('change', function () {
                this.closest('form').submit();
            });
        });

        // Company card hover effects
        document.querySelectorAll('.company-card').forEach(card => {
            card.addEventListener('mouseenter', function () {
                this.style.transform = 'translateY(-2px)';
                this.style.transition = 'transform 0.2s ease';
            });

            card.addEventListener('mouseleave', function () {
                this.style.transform = 'translateY(0)';
            });
        });
    </script>
}
