@model License_Tracking.Models.Oem

@{
    ViewData["Title"] = $"Edit OEM Partner - {Model.OemName}";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="text-primary mb-1">
                        <i class="fas fa-edit"></i> Edit OEM Partner
                    </h2>
                </div>
                <div class="d-flex gap-2">
                    <a asp-action="Details" asp-route-id="@Model.OemId" class="btn btn-outline-info">
                        <i class="fas fa-eye"></i> View Profile
                    </a>
                    <a asp-action="Index" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left"></i> Back to List
                    </a>
                </div>
            </div>

            <!-- Form -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-gradient-primary text-white border-bottom-0">
                    <h5 class="mb-0 text-white">
                        <i class="fas fa-building"></i> @Model.OemName - Partner Information
                    </h5>
                    <small class="text-white-50">Update partner details, service level, and performance rating</small>
                </div>
                <div class="card-body">
                    <form asp-action="Edit" method="post">
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>
                        
                        <!-- Hidden fields -->
                        <input type="hidden" asp-for="OemId" />
                        <input type="hidden" asp-for="CreatedDate" />
                        <input type="hidden" asp-for="CreatedBy" />
                        <input type="hidden" asp-for="IsActive" />

                        <!-- Basic Information Section -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-primary border-bottom pb-2 mb-3">
                                    <i class="fas fa-info-circle"></i> Basic Information
                                </h6>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label asp-for="OemName" class="form-label fw-semibold">
                                        OEM Partner Name <span class="text-danger">*</span>
                                    </label>
                                    <input asp-for="OemName" class="form-control" placeholder="Enter OEM partner name" />
                                    <span asp-validation-for="OemName" class="text-danger"></span>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label asp-for="Website" class="form-label fw-semibold">Website</label>
                                    <input asp-for="Website" type="url" class="form-control" placeholder="https://www.example.com" />
                                    <span asp-validation-for="Website" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information Section -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-primary border-bottom pb-2 mb-3">
                                    <i class="fas fa-address-book"></i> Contact Information
                                </h6>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label asp-for="ContactEmail" class="form-label fw-semibold">Contact Email</label>
                                    <input asp-for="ContactEmail" type="email" class="form-control" placeholder="contact@oem.com" />
                                    <span asp-validation-for="ContactEmail" class="text-danger"></span>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label asp-for="ContactNumber" class="form-label fw-semibold">Contact Number</label>
                                    <input asp-for="ContactNumber" type="tel" class="form-control" placeholder="+1 (555) 123-4567" />
                                    <span asp-validation-for="ContactNumber" class="text-danger"></span>
                                </div>
                            </div>
                            
                            <div class="col-12">
                                <div class="form-group mb-3">
                                    <label asp-for="Address" class="form-label fw-semibold">Address</label>
                                    <textarea asp-for="Address" class="form-control" rows="3" placeholder="Enter complete business address"></textarea>
                                    <span asp-validation-for="Address" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Business Terms & Performance Section -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-primary border-bottom pb-2 mb-3">
                                    <i class="fas fa-handshake"></i> Business Terms & Performance Tracking
                                </h6>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label asp-for="PaymentTerms" class="form-label fw-semibold">Payment Terms</label>
                                    <select asp-for="PaymentTerms" class="form-select">
                                        <option value="">Select Payment Terms</option>
                                        <option value="Net 15">Net 15 Days</option>
                                        <option value="Net 30">Net 30 Days</option>
                                        <option value="Net 45">Net 45 Days</option>
                                        <option value="Net 60">Net 60 Days</option>
                                        <option value="Net 90">Net 90 Days</option>
                                        <option value="Immediate">Immediate Payment</option>
                                        <option value="Cash on Delivery">Cash on Delivery</option>
                                        <option value="Prepaid">Prepaid</option>
                                    </select>
                                    <span asp-validation-for="PaymentTerms" class="text-danger"></span>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label asp-for="ServiceLevel" class="form-label fw-semibold">Service Level Tracking</label>
                                    <select asp-for="ServiceLevel" class="form-select">
                                        <option value="">Select Service Level</option>
                                        <option value="Gold">Gold Partner (Premium)</option>
                                        <option value="Silver">Silver Partner (Standard)</option>
                                        <option value="Bronze">Bronze Partner (Basic)</option>
                                    </select>
                                    <span asp-validation-for="ServiceLevel" class="text-danger"></span>
                                    <div class="form-text">
                                        Service level determines priority and support tier
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label asp-for="PerformanceRating" class="form-label fw-semibold">Performance Rating</label>
                                    <select asp-for="PerformanceRating" class="form-select">
                                        <option value="">Not Rated</option>
                                        <option value="5.0">5.0 - Excellent</option>
                                        <option value="4.5">4.5 - Very Good</option>
                                        <option value="4.0">4.0 - Good</option>
                                        <option value="3.5">3.5 - Average</option>
                                        <option value="3.0">3.0 - Below Average</option>
                                        <option value="2.5">2.5 - Poor</option>
                                        <option value="2.0">2.0 - Very Poor</option>
                                        <option value="1.5">1.5 - Unsatisfactory</option>
                                        <option value="1.0">1.0 - Unacceptable</option>
                                    </select>
                                    <span asp-validation-for="PerformanceRating" class="text-danger"></span>
                                    <div class="form-text">
                                        Update performance rating based on recent interactions (1.0 - 5.0)
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label class="form-label fw-semibold text-muted">Record Information</label>
                                    <div class="bg-light p-3 rounded">
                                        <small class="text-muted">
                                            <strong>Created:</strong> @Model.CreatedDate.ToString("MMM dd, yyyy 'at' h:mm tt")<br>
                                            <strong>OEM ID:</strong> @Model.OemId<br>
                                            <strong>Status:</strong> @(Model.IsActive ? "Active" : "Inactive")
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="row">
                            <div class="col-12">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="form-text">
                                        <i class="fas fa-info-circle"></i>
                                        Fields marked with <span class="text-danger">*</span> are required
                                    </div>
                                    <div class="btn-group">
                                        <a asp-action="Details" asp-route-id="@Model.OemId" class="btn btn-outline-info">
                                            <i class="fas fa-times"></i> Cancel
                                        </a>
                                        <button type="submit" class="btn btn-warning">
                                            <i class="fas fa-save"></i> Update OEM Partner
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Related Information -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card border-0 bg-light">
                        <div class="card-body">
                            <h6 class="text-primary">
                                <i class="fas fa-box"></i> Product Portfolio
                            </h6>
                            <p class="mb-2">This OEM has <strong>@(Model.Products?.Count ?? 0)</strong> products in the catalog.</p>
                            <a asp-controller="Products" asp-action="Index" asp-route-oemId="@Model.OemId" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-box"></i> Manage Products
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card border-0 bg-light">
                        <div class="card-body">
                            <h6 class="text-primary">
                                <i class="fas fa-handshake"></i> Active Deals
                            </h6>
                            <p class="mb-2">This OEM has <strong>@(Model.Deals?.Count ?? 0)</strong> active deals.</p>
                            <a asp-controller="Deals" asp-action="Index" asp-route-oemId="@Model.OemId" class="btn btn-sm btn-outline-success">
                                <i class="fas fa-handshake"></i> View Deals
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        // Auto-format phone number
        $('input[name="ContactNumber"]').on('input', function() {
            let value = this.value.replace(/\D/g, '');
            if (value.length >= 10) {
                value = value.replace(/(\d{3})(\d{3})(\d{4})/, '($1) $2-$3');
            }
            this.value = value;
        });
        
        // URL validation for website
        $('input[name="Website"]').on('blur', function() {
            let url = this.value;
            if (url && !url.startsWith('http://') && !url.startsWith('https://')) {
                this.value = 'https://' + url;
            }
        });
        
        // Service level badge preview
        $('select[name="ServiceLevel"]').on('change', function() {
            const level = this.value;
            let badgeClass = 'secondary';
            if (level === 'Gold') badgeClass = 'warning';
            else if (level === 'Silver') badgeClass = 'secondary';
            else if (level === 'Bronze') badgeClass = 'dark';
            
            // Show preview near the dropdown
            let preview = $(this).next('.service-level-preview');
            if (preview.length === 0) {
                preview = $('<div class="service-level-preview mt-1"></div>');
                $(this).after(preview);
            }
            
            if (level) {
                preview.html(`<span class="badge badge-${badgeClass}">${level} Partner</span>`);
            } else {
                preview.empty();
            }
        });
        
        // Performance rating star preview
        $('select[name="PerformanceRating"]').on('change', function() {
            const rating = parseFloat(this.value) || 0;
            let preview = $(this).next('.rating-preview');
            if (preview.length === 0) {
                preview = $('<div class="rating-preview mt-1"></div>');
                $(this).after(preview);
            }
            
            if (rating > 0) {
                let stars = '';
                for (let i = 1; i <= 5; i++) {
                    stars += `<i class="fas fa-star ${i <= rating ? 'text-warning' : 'text-muted'}"></i> `;
                }
                preview.html(`${stars}<small class="text-muted">(${rating.toFixed(1)})</small>`);
            } else {
                preview.empty();
            }
        });

        // Initialize previews if values are already set
        $(document).ready(function() {
            $('select[name="ServiceLevel"]').trigger('change');
            $('select[name="PerformanceRating"]').trigger('change');
        });
    </script>
}
